<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GSK LAND ‚Äî –±–∏–∑–Ω–µ—Å-–∏–≥—Ä–∞ v2</title>
  <meta name="description" content="GSK LAND ‚Äî –±–∏–∑–Ω–µ—Å-–∏–≥—Ä–∞. –ú–∞–≥–∞–∑–∏–Ω, –º–æ–∏ –±–∏–∑–Ω–µ—Å—ã, —Ä–µ–π—Ç–∏–Ω–≥, –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å." />
  <style>
    /* Emerald - dark liquid glass theme */
    :root{
      --bg:#071018;
      --panel: rgba(255,255,255,0.03);
      --panel-2: rgba(255,255,255,0.02);
      --glass-border: rgba(255,255,255,0.04);
      --accent-start:#0fb48b; /* emerald */
      --accent-end:#1aa6d9; /* cyan */
      --card-radius:18px;
      --muted:#9fb3bf;
      --text:#e8f6f4;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background: radial-gradient(800px 400px at 10% 10%, rgba(26,166,217,0.06), transparent), radial-gradient(1000px 500px at 90% 80%, rgba(15,180,139,0.06), transparent), var(--bg); color:var(--text)}
    .app{max-width:1100px;margin:64px auto;padding:28px;backdrop-filter: blur(10px) saturate(120%); background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02)); border-radius:24px; border:1px solid var(--glass-border); box-shadow: 0 12px 40px rgba(2,6,23,0.7);}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;font-size:22px;letter-spacing:0.4px}
    nav{display:flex;gap:8px}
    .nav-btn{padding:10px 14px;border-radius:12px;background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--glass-border);cursor:pointer;color:var(--text)}
    .nav-btn.active{box-shadow: inset 0 -2px 0 rgba(0,0,0,0.25);}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    .col{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03)); padding:18px;border-radius:var(--card-radius); border:1px solid var(--glass-border)}
    .card{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));border:1px solid var(--glass-border);margin-bottom:12px}
    .shop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .biz-card{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));border:1px solid var(--glass-border)}
    .btn{display:inline-block;padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent-start),var(--accent-end));color:white;text-decoration:none;border:none;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    input,select,textarea{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;width:100%;box-sizing:border-box}
    .small{font-size:13px}
    .flex{display:flex;gap:8px;align-items:center}
    .right{justify-content:flex-end}
    .hidden{display:none !important}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    #hud{position:fixed;top:12px;left:50%;transform:translateX(-50%);height:56px;backdrop-filter:blur(10px);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:8px 16px;border:1px solid var(--glass-border);display:flex;align-items:center;gap:16px;z-index:1000;min-width:320px}
    .news-item{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);margin-bottom:8px}
    .clicker-btn{padding:20px;font-size:18px;border-radius:15px;background:linear-gradient(90deg,#ff6b6b,#ff8e53);cursor:pointer;border:none;color:white;margin:10px 0}
    .progress-bar{height:20px;background:rgba(255,255,255,0.1);border-radius:10px;margin:10px 0;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent-start),var(--accent-end));border-radius:10px;transition:width 0.3s}
    .achievement-card{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));border:1px solid var(--glass-border);margin-bottom:8px}
    .achievement-locked{opacity:0.6}
    .admin-table{width:100%;border-collapse:collapse;margin-top:10px}
    .admin-table th,.admin-table td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.1)}
    .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:10000}
    .modal-content{background:var(--bg);padding:20px;border-radius:var(--card-radius);border:1px solid var(--glass-border);max-width:400px;width:100%}
    .admin-tabs{display:flex;gap:8px;margin-bottom:16px}
    .admin-tab{padding:10px 16px;border-radius:10px;background:var(--panel);cursor:pointer;border:1px solid var(--glass-border)}
    .admin-tab.active{background:linear-gradient(90deg,var(--accent-start),var(--accent-end))}

    /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô */
    .notifications-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
    }

    .notifications-content {
      background: var(--bg);
      padding: 20px;
      border-radius: var(--card-radius);
      border: 1px solid var(--glass-border);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .notifications-content h3 {
      margin-top: 0;
     display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notifications-content .close-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }

	.empty-notifications {
	  text-align: center;
	  padding: 20px;
	  color: var(--muted);
	}

	/* –î–û–ë–ê–í–ò–¢–¨ –≠–¢–ò –°–¢–ò–õ–ò –ü–û–°–õ–ï */
	.notification-toast {
	  position: fixed;
	  top: 20px;
	  right: 20px;
	  background: var(--bg);
	  border: 1px solid var(--glass-border);
	  border-radius: var(--card-radius);
	  padding: 15px;
	  max-width: 300px;
	  z-index: 10002;
	  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
	  transform: translateX(100%);
	  transition: transform 0.3s ease;
	}

	.notification-toast.show {
	  transform: translateX(0);
	}

	.notification-badge {
	  background: #ff4757;
	  color: white;
	  border-radius: 50%;
	  width: 20px;
	  height: 20px;
	  text-align: center;
	  line-height: 20px;
	  font-size: 12px;
	  cursor: pointer;
	}
  </style>
  </style>
</head>
<body>
  <div id="hud" class="hidden">
    <div style="display:flex;gap:10px;align-items:center"><strong id="hud-username"></strong><span class="muted" id="hud-email"></span></div>
    <div style="margin-left:auto">
      <span style="margin-right:16px">–ë–∞–ª–∞–Ω—Å: <strong id="hud-balance">0</strong> ‚ÇΩ</span>
      <div id="notification-badge" class="notification-badge hidden" style="position:relative;display:inline-block;cursor:pointer">0</div>
    </div>
  </div>

  <div id="sell-modal" class="hidden modal">
    <div class="modal-content">
      <h3>–ü—Ä–æ–¥–∞–∂–∞ –±–∏–∑–Ω–µ—Å–∞ –∏–≥—Ä–æ–∫—É</h3>
      <input id="sell-username" placeholder="–ù–∏–∫–Ω–µ–π–º –∏–≥—Ä–æ–∫–∞" style="margin-top:12px" />
      <input id="sell-price" placeholder="–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏" type="number" style="margin-top:8px" />
      <div class="flex" style="justify-content:space-between;margin-top:16px">
        <button class="btn" id="sell-cancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="sell-confirm">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –£–í–ï–î–û–ú–õ–ï–ù–ò–ô -->
  <div id="notifications-modal" class="notifications-modal hidden">
    <div class="notifications-content">
      <h3>
        –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        <button class="close-btn" id="close-notifications">√ó</button>
      </h3>
      <div id="notifications-list"></div>
      <div id="empty-notifications" class="empty-notifications hidden">
        –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      </div>
    </div>
  </div>

  <div class="app" id="app">
    <header>
      <div>
        <h1>GSK LAND ‚Äî –±–∏–∑–Ω–µ—Å-–∏–≥—Ä–∞</h1>
        <div class="muted small">–°—Ç–∞–Ω—å —É—Å–ø–µ—à–Ω—ã–º –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–º!</div>
      </div>
      <nav id="nav">
        <button class="nav-btn active" data-view="home">–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="nav-btn" data-view="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="nav-btn" data-view="my">–ú–æ–∏ –±–∏–∑–Ω–µ—Å—ã</button>
        <button class="nav-btn" data-view="rating">–†–µ–π—Ç–∏–Ω–≥</button>
        <button class="nav-btn" data-view="clicker">–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</button>
        <button class="nav-btn" data-view="quests">–ó–∞–¥–∞–Ω–∏—è</button>
        <button class="nav-btn" data-view="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        <button class="nav-btn" data-view="promocodes">–ü—Ä–æ–º–æ–∫–æ–¥—ã</button>
        <button class="nav-btn" data-view="news">–ù–æ–≤–æ—Å—Ç–∏</button>
        <button class="nav-btn hidden" id="nav-admin" data-view="admin">–ê–¥–º–∏–Ω</button>
      </nav>
    </header>

    <div class="grid">
      <main class="col" id="main">
        <section id="view-home">
          <div class="card">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GSK LAND</h2>
            <p class="muted">–ü–æ–∫—É–ø–∞–π —Ä–µ–∞–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å—ã –≤ –≥–æ—Ä–æ–¥–µ, —Å–æ–±–∏—Ä–∞–π –¥–æ—Ö–æ–¥, –ø—Ä–æ–¥–∞–≤–∞–π –∏ –ø–æ–¥–Ω–∏–º–∞–π—Å—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ. –ö–∞–∂–¥—ã–π –±–∏–∑–Ω–µ—Å —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –∏–≥—Ä–æ–∫—É.</p>
          </div>

          <div class="card" id="auth-area">
            <div id="user-info" class="hidden">
              <div class="flex" style="justify-content:space-between">
                <div>
                  <strong id="display-name"></strong>
                  <div class="muted small" id="display-email"></div>
                </div>
                <div class="flex">
                  <div class="muted small">–ë–∞–ª–∞–Ω—Å:</div>
                  <div style="min-width:90px;text-align:right"><strong id="balance">0</strong> ‚ÇΩ</div>
                </div>
              </div>
              <div style="margin-top:10px" class="flex">
                <button class="btn" id="btn-logout">–í—ã–π—Ç–∏</button>
                <button class="btn" id="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
              </div>
            </div>

            <div id="auth-forms">
              <div style="display:flex;gap:12px;align-items:center">
                <div style="flex:1">
                  <h3>–í—Ö–æ–¥</h3>
                  <input id="login-email" placeholder="Email" />
                  <input id="login-pass" placeholder="–ü–∞—Ä–æ–ª—å" type="password" style="margin-top:8px" />
                  <div style="margin-top:8px"><button class="btn" id="btn-login">–í–æ–π—Ç–∏</button></div>
                </div>
                <div style="width:1px;background:rgba(255,255,255,0.02);height:160px"></div>
                <div style="flex:1">
                  <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                  <input id="reg-username" placeholder="–ù–∏–∫–Ω–µ–π–º" />
                  <input id="reg-email" placeholder="Email" style="margin-top:8px" />
                  <input id="reg-pass" placeholder="–ü–∞—Ä–æ–ª—å" type="password" style="margin-top:8px" />
                  <input id="reg-pass2" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" type="password" style="margin-top:8px" />
                  <input id="reg-codeword" placeholder="–ö–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ" style="margin-top:8px" />
                  <div style="margin-top:8px" class="flex"><button class="btn" id="btn-register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h3>
            <ol class="muted small">
              <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –∏ —Å–æ–∑–¥–∞–π –Ω–∏–∫–Ω–µ–π–º.</li>
              <li>–û—Ç–∫—Ä–æ–π –ú–∞–≥–∞–∑–∏–Ω –∏ –∫—É–ø–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π –±–∏–∑–Ω–µ—Å (–∫–∞–∂–¥—ã–π –±–∏–∑–Ω–µ—Å –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –∏–≥—Ä–æ–∫—É).</li>
              <li>–ó–∞—Ö–æ–¥–∏ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ú–æ–∏ –±–∏–∑–Ω–µ—Å—ã¬ª –∏ —Å–æ–±–∏—Ä–∞–π –¥–æ—Ö–æ–¥ ‚Äî –∫–Ω–æ–ø–∫–∞ "–°–æ–±—Ä–∞—Ç—å" –Ω–∞—á–∏—Å–ª–∏—Ç –¥–æ—Ö–æ–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±–æ—Ä–∞.</li>
              <li>–ú–æ–∂–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É (-30% –æ—Ç —Ü–µ–Ω—ã) –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–≥—Ä–æ–∫—É (—Ü–µ–Ω–∞ –æ—Ç 50% –¥–æ 200% –æ—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–π).</li>
              <li>–°–ª–µ–¥–∏ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º –≤ HUD –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞.</li>
            </ol>
          </div>
        </section>

        <section id="view-shop" class="hidden">
          <h2>–ú–∞–≥–∞–∑–∏–Ω –±–∏–∑–Ω–µ—Å–æ–≤</h2>
          <div id="shop-list" class="shop-grid" style="margin-top:12px"></div>
        </section>

        <section id="view-my" class="hidden">
          <h2>–ú–æ–∏ –±–∏–∑–Ω–µ—Å—ã</h2>
          <div class="card">
            <div class="flex" style="justify-content:space-between;align-items:center">
              <div>–°–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –±–∏–∑–Ω–µ—Å–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–°–æ–±—Ä–∞—Ç—å" —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –¥–æ—Ö–æ–¥.</div>
              <div><button class="btn" id="collect-all">–°–æ–±—Ä–∞—Ç—å —Å–æ –≤—Å–µ—Ö</button></div>
            </div>
          </div>
          <div id="my-list" style="margin-top:12px"></div>
        </section>

        <section id="view-rating" class="hidden">
          <h2>–†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h2>
          <div id="rating-list" style="margin-top:12px"></div>
        </section>

        <section id="view-clicker" class="hidden">
          <h2>–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</h2>
          <div class="card">
            <p>–ö–ª–∏–∫–∞–π –Ω–∞ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–Ω—å–≥–∏! –ö–∞–∂–¥—ã–π –∫–ª–∏–∫ = 5 ‚ÇΩ</p>
            <button class="clicker-btn" id="clicker-button">–ö–õ–ò–ö–ê–ô –ó–ê –î–ï–ù–¨–ì–ê–ú–ò!</button>
            <div class="flex" style="justify-content:space-between">
              <div>–ù–∞–∫–æ–ø–ª–µ–Ω–æ: <strong id="clicker-amount">0</strong> ‚ÇΩ</div>
              <button class="btn" id="clicker-collect">–ó–∞–±—Ä–∞—Ç—å</button>
            </div>
            <div class="muted small">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: <span id="total-clicks">0</span></div>
            <div class="muted small">–ö–ª–∏–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è: <span id="daily-clicks">0</span></div>
          </div>
        </section>

        <section id="view-quests" class="hidden">
          <h2>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
          <div id="quests-list" style="margin-top:12px"></div>
        </section>

        <section id="view-achievements" class="hidden">
          <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
          <div id="achievements-list" style="margin-top:12px"></div>
        </section>

        <section id="view-promocodes" class="hidden">
          <h2>–ü—Ä–æ–º–æ–∫–æ–¥—ã</h2>
          <div class="card">
            <input id="promocode-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" />
            <div style="margin-top:8px"><button class="btn" id="promocode-activate">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button></div>
          </div>
          <div id="promocodes-list" style="margin-top:12px"></div>
        </section>

        <section id="view-news" class="hidden">
          <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
          <div id="news-list" style="margin-top:12px"></div>
          <div id="news-admin" class="hidden" style="margin-top:20px">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h3>
            <input id="news-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" />
            <textarea id="news-content" placeholder="–¢–µ–∫—Å—Ç" style="margin-top:8px"></textarea>
            <div style="margin-top:8px"><button class="btn" id="news-add">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button></div>
          </div>
        </section>

        <section id="view-admin" class="hidden">
          <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
  
          <div class="admin-tabs">
            <button class="admin-tab active" data-tab="users">–ò–≥—Ä–æ–∫–∏</button>
            <button class="admin-tab" data-tab="businesses">–ë–∏–∑–Ω–µ—Å—ã</button>
            <button class="admin-tab" data-tab="promocodes">–ü—Ä–æ–º–æ–∫–æ–¥—ã</button>
          </div>

          <div id="admin-users" class="admin-tab-content">
            <div class="card">
              <h3>–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞</h3>
              <input id="admin-search-user" placeholder="–ù–∏–∫–Ω–µ–π–º, email –∏–ª–∏ –∫–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ" />
              <div style="margin-top:8px"><button class="btn" id="admin-search-btn">–ù–∞–π—Ç–∏</button></div>
            </div>
            <div class="card">
              <h3>–í—Å–µ –∏–≥—Ä–æ–∫–∏</h3>
              <div id="admin-users-list"></div>
            </div>
          </div>

          <div id="admin-businesses" class="admin-tab-content hidden">
            <div class="card">
              <h3>–°–æ–∑–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å</h3>
              <input id="admin-biz-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
              <input id="admin-biz-price" placeholder="–¶–µ–Ω–∞" style="margin-top:8px" type="number" />
              <input id="admin-biz-income" placeholder="–î–æ—Ö–æ–¥ –≤ —á–∞—Å" style="margin-top:8px" type="number" />
              <input id="admin-biz-icon" placeholder="URL –∏–∫–æ–Ω–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" style="margin-top:8px" />
              <div style="margin-top:8px"><button class="btn" id="admin-create-biz">–°–æ–∑–¥–∞—Ç—å</button></div>
            </div>
          </div>

          <div id="admin-promocodes" class="admin-tab-content hidden">
            <div class="card">
              <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏</h3>
              <input id="admin-promo-code" placeholder="–ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞" />
              <input id="admin-promo-amount" placeholder="–°—É–º–º–∞" type="number" style="margin-top:8px" />
              <input id="admin-promo-uses" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π" type="number" style="margin-top:8px" value="1" />
              <div style="margin-top:8px">
                <button class="btn" id="admin-create-promo">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
                <button class="btn" style="background:rgba(200,60,60,0.9);margin-top:8px" id="admin-delete-promo">–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
              </div>
            </div>
          </div>
        </section>

        </main>
		
		<aside class="col">
          <div class="card">
            <h3>–ü–æ–∏—Å–∫ –±–∏–∑–Ω–µ—Å–∞</h3>
            <input id="search-biz" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞" />
            <div style="margin-top:8px"><button class="btn" id="search-btn">–ù–∞–π—Ç–∏</button></div>
          </div>
        </aside>
      </div>

        <footer>GSK LAND</footer>

        <!-- Firebase -->
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
        <script>
          // === –¢–í–û–ò –ö–õ–Æ–ß–ò FIREBASE ===
          const firebaseConfig = {
            apiKey: "AIzaSyAZPTcPsHVAw1RiuOUhM9IXZTSWJdRAW-c",
            authDomain: "gskland2.firebaseapp.com",
            projectId: "gskland2",
            storageBucket: "gskland2.firebasestorage.app",
            messagingSenderId: "615778317319",
            appId: "1:615778317319:web:d875f784f280f5758926a2",
            measurementId: "G-GPWV7RJK8X"
          };
  
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
          firebase.initializeApp(firebaseConfig);
          const auth = firebase.auth();
          const db = firebase.firestore();

          // UI —ç–ª–µ–º–µ–Ω—Ç—ã
          const navButtons = document.querySelectorAll('.nav-btn');
          const views = {
            home: document.getElementById('view-home'),
            shop: document.getElementById('view-shop'),
            my: document.getElementById('view-my'),
            rating: document.getElementById('view-rating'),
            clicker: document.getElementById('view-clicker'),
            quests: document.getElementById('view-quests'),
            achievements: document.getElementById('view-achievements'),
            promocodes: document.getElementById('view-promocodes'),
            news: document.getElementById('view-news'),
            admin: document.getElementById('view-admin')
          };

          // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
          let currentSellBizId = null;
          let dealsListener = null;
          let activeDeals = new Map();
  
          // –ù–∞–≤–∏–≥–∞—Ü–∏—è
          navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
              document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
              const view = btn.dataset.view;
              Object.values(views).forEach(v => v.classList.add('hidden'));
              views[view].classList.remove('hidden');
      
              // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
              if (view === 'rating') renderRating();
              if (view === 'clicker') renderClicker();
              if (view === 'quests') renderQuests();
              if (view === 'achievements') renderAchievements();
              if (view === 'promocodes') renderPromocodes();
              if (view === 'admin' && isAdminUser(currentUserDoc, currentUser)) {
                renderAdminUsers();
                setupAdminTabs();
              }
            });
          });

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
          function isAdminUser(userDoc, user) {
            if (!user) return false;
            const email = (user && user.email) ? user.email.toLowerCase() : '';
            const username = (userDoc && userDoc.username) ? userDoc.username : (user.displayName || '');
            return username === 'Spotty' || email === 'sad.spotty@gmail.com';
          }

          let currentUser = null;
          let currentUserDoc = null;

          // –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
          function showNotificationToast(dealId, sellerName, bizName, price) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            const existingToast = document.getElementById(`toast-${dealId}`);
            if (existingToast) {
              existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.id = `toast-${dealId}`;
            toast.className = 'notification-toast';
            toast.innerHTML = `
              <h4>üíº –ù–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!</h4>
              <p><strong>–û—Ç:</strong> ${sellerName}</p>
              <p><strong>–ë–∏–∑–Ω–µ—Å:</strong> ${bizName}</p>
              <p><strong>–¶–µ–Ω–∞:</strong> ${price} ‚ÇΩ</p>
              <div class="flex">
                <button class="btn accept-btn" data-id="${dealId}">–ü—Ä–∏–Ω—è—Ç—å</button>
                <button class="btn reject-btn" data-id="${dealId}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
              </div>
            `;

            document.body.appendChild(toast);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            setTimeout(() => {
              toast.classList.add('show');
            }, 100);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            toast.querySelector('.accept-btn').addEventListener('click', () => {
              acceptDeal(dealId);
              toast.remove();
            });

            toast.querySelector('.reject-btn').addEventListener('click', () => {
              rejectDeal(dealId);
              toast.remove();
            });

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
              if (toast.parentNode) {
                toast.remove();
              }
            }, 30000);
          }

          // Real-time listener –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–¥–µ–ª–æ–∫
		  // Real-time listener –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–¥–µ–ª–æ–∫
		  function setupDealsListener() {
		    if (!currentUser) return;

		    console.log('Setting up deals listener for user:', currentUser.uid);

		    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π listener –µ—Å–ª–∏ –µ—Å—Ç—å
		    if (dealsListener) {
			  dealsListener();
		    }

		    dealsListener = db.collection('deals')
			  .where('toUid', '==', currentUser.uid)
			  .where('state', '==', 'pending')
			  .onSnapshot((snapshot) => {
			    const notificationBadge = document.getElementById('notification-badge');

			    let activeDealsCount = 0;
			   activeDeals.clear();

			    snapshot.forEach((doc) => {
				  const deal = doc.data();
				  deal.id = doc.id;
				  activeDeals.set(deal.id, deal);
				  activeDealsCount++;
				
				  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫
				  if (!deal.seen) {
				    showDealNotification(deal);
				    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–µ
				    db.collection('deals').doc(deal.id).update({ seen: true });
				  }
			    });

			    // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂
			    if (activeDealsCount > 0) {
				  notificationBadge.textContent = activeDealsCount;
				  notificationBadge.classList.remove('hidden');
			    } else {
				  notificationBadge.classList.add('hidden');
			    }
			  }, (error) => {
			    console.error('–û—à–∏–±–∫–∞ listener —Å–¥–µ–ª–æ–∫:', error);
			  });

		  // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–¥–µ–ª–∫–µ
		  async function showDealNotification(deal) {
		    try {
			  const sellerSnap = await db.collection('users').doc(deal.fromUid).get();
			  const bizSnap = await db.collection('businesses').doc(deal.bizId).get();

			  if (sellerSnap.exists && bizSnap.exists) {
			    const seller = sellerSnap.data();
			    const biz = bizSnap.data();

			    showNotificationToast(deal.id, seller.username, biz.name, deal.price);
			  }
		    } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
		    }
		  }

		// ‚Üê –í–°–¢–ê–í–¨ –ó–î–ï–°–¨ –ù–ê–ß–ò–ù–ê–Ø –° –≠–¢–û–ô –°–¢–†–û–ö–ò ‚Üì

		  // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
		  // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
		  function showNotificationsModal() {
		    const modal = document.getElementById('notifications-modal');
		    const list = document.getElementById('notifications-list');
		    const empty = document.getElementById('empty-notifications');
		  
		    list.innerHTML = '';
		  
		    if (activeDeals.size === 0) {
			  empty.classList.remove('hidden');
			  list.classList.add('hidden');
		    } else {
			  empty.classList.add('hidden');
			  list.classList.remove('hidden');
			
			  // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –ø—Ä–æ–º–∏—Å–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Å–¥–µ–ª–∫–∞—Ö
			  const loadPromises = Array.from(activeDeals.values()).map(async (deal) => {
			    try {
				  const sellerSnap = await db.collection('users').doc(deal.fromUid).get();
				  const bizSnap = await db.collection('businesses').doc(deal.bizId).get();
				
				  if (sellerSnap.exists && bizSnap.exists) {
				    const seller = sellerSnap.data();
				    const biz = bizSnap.data();
				  
				    const el = document.createElement('div');
				    el.className = 'news-item';
				    el.innerHTML = `
					  <strong>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ</strong>
					  <div class="muted small">–û—Ç: ${seller.username}</div>
					  <div>–ë–∏–∑–Ω–µ—Å: ${biz.name}</div>
					  <div>–¶–µ–Ω–∞: ${deal.price} ‚ÇΩ</div>
					  <div class="flex" style="margin-top:8px;gap:8px">
					    <button class="btn accept-btn" data-id="${deal.id}">–ü—Ä–∏–Ω—è—Ç—å</button>
					    <button class="btn reject-btn" style="background:rgba(200,60,60,0.9)" data-id="${deal.id}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
					  </div>
				  `  ;
				  
				    list.appendChild(el);
				  
				    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
				    el.querySelector('.accept-btn').addEventListener('click', async () => {
					  await acceptDeal(deal.id);
					  modal.classList.add('hidden');
				    });
				  
				    el.querySelector('.reject-btn').addEventListener('click', async () => {
					  await rejectDeal(deal.id);
					  modal.classList.add('hidden');
				    });
				  }
			    } catch (error) {
				  console.error('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏:', error);
			    }
			  });
			
			  // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
			  Promise.all(loadPromises).catch(error => {
			    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
			  });
		    }
		  
		    modal.classList.remove('hidden');
		  }

		  // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
		  document.getElementById('close-notifications').addEventListener('click', () => {
		    document.getElementById('notifications-modal').classList.add('hidden');
		  });

		  // –ö–ª–∏–∫ –ø–æ –±–µ–π–¥–∂—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
		  document.getElementById('notification-badge').addEventListener('click', () => {
		    if (activeDeals.size > 0) {
			  showNotificationsModal();
		    }
		  });

		  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
		  document.getElementById('notifications-modal').addEventListener('click', (e) => {
		    if (e.target.id === 'notifications-modal') {
			  document.getElementById('notifications-modal').classList.add('hidden');
		    }
		  });

		  // ‚Üí –ö–û–ù–ï–¶ –≤—Å—Ç–∞–≤–∫–∏ ‚Üë

		  // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∏—è —Å–¥–µ–ª–∫–∏
		  async function acceptDeal(dealId) {
		    try {
			  await db.runTransaction(async (tx) => {
			    const dealRef = db.collection('deals').doc(dealId);
			    const dealDoc = await tx.get(dealRef);

			    if (!dealDoc.exists) throw new Error('–°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
			  
			    const dealData = dealDoc.data();

			    if (dealData.state !== 'pending') throw new Error('–°–¥–µ–ª–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞');
			    if (dealData.toUid !== currentUser.uid) throw new Error('–ù–µ –≤–∞—à–∞ —Å–¥–µ–ª–∫–∞');

			    const buyerRef = db.collection('users').doc(currentUser.uid);
			    const sellerRef = db.collection('users').doc(dealData.fromUid);
			    const bizRef = db.collection('businesses').doc(dealData.bizId);

			    const buyerDoc = await tx.get(buyerRef);
			    const sellerDoc = await tx.get(sellerRef);
			    const bizDoc = await tx.get(bizRef);

			    const buyerData = buyerDoc.data();
			    const sellerData = sellerDoc.data();
			    const bizData = bizDoc.data();

			    if (buyerData.balance < dealData.price) throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
			    if (bizData.ownerUid !== dealData.fromUid) throw new Error('–ë–∏–∑–Ω–µ—Å —É–∂–µ –ø—Ä–æ–¥–∞–Ω');

			    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã
			    tx.update(buyerRef, { 
				  balance: firebase.firestore.FieldValue.increment(-dealData.price) 
			    });

			    tx.update(sellerRef, { 
				  balance: firebase.firestore.FieldValue.increment(dealData.price) 
			    });

			    // –ú–µ–Ω—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–∏–∑–Ω–µ—Å–∞
			    tx.update(bizRef, { 
				  ownerUid: currentUser.uid,
				  lastCollectedAt: firebase.firestore.FieldValue.serverTimestamp() 
			    });
			  
			    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏
			    tx.update(dealRef, { 
				  state: 'accepted',
				  acceptedAt: firebase.firestore.FieldValue.serverTimestamp()
			    });
			  });

			  alert('–°–¥–µ–ª–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!');
			  await refreshUserDoc();
			  await renderShop();
			  await renderMyBusinesses();
			  await renderRating();
		    } catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
		    }
		  }

		  // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏
		  async function rejectDeal(dealId) {
		    try {
			  await db.collection('deals').doc(dealId).update({ 
			    state: 'rejected',
			    rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
			  });
			  alert('–°–¥–µ–ª–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
		    } catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
		    }
		  }

		  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –¢–û–õ–¨–ö–û –≠–¢–û–¢ –í–ê–†–ò–ê–ù–¢!
		  auth.onAuthStateChanged(async (user) => {
		    currentUser = user;
		  
		    // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º HUD –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
		    document.getElementById('hud').classList.add('hidden');
		    document.getElementById('user-info').classList.add('hidden');
		    document.getElementById('auth-forms').classList.remove('hidden');
		    document.getElementById('nav-admin').classList.add('hidden');
		    document.getElementById('news-admin').classList.add('hidden');
		   
		    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π listener —Å–¥–µ–ª–æ–∫
		    if (dealsListener) {
			  dealsListener();
			  dealsListener = null;
		      }

		    if (user) {
			  // –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ê–í–¢–û–†–ò–ó–û–í–ê–ù
			  try {
			    const userRef = db.collection('users').doc(user.uid);
			    const userSnap = await userRef.get();

			    if (userSnap.exists) {
				  currentUserDoc = userSnap.data();
			    } else {
				  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
				  const newUserData = { 
				    username: user.displayName || '', 
				    email: user.email || '', 
				    balance: 10000,
				    codeword: document.getElementById('reg-codeword')?.value || '',
				    totalClicks: 0,
				    clickerAmount: 0,
				    achievements: {
					  dailyQuest: false,
					  thousandClicks: false
				    },
				    questProgress: {
					  dailyClicks: 0
				    },
				    usedPromocodes: [],
				    createdAt: firebase.firestore.FieldValue.serverTimestamp()
				  };
				  await userRef.set(newUserData);
				  currentUserDoc = newUserData;
			    }

			    // –û–ë–ù–û–í–õ–Ø–ï–ú UI –î–õ–Ø –ê–í–¢–û–†–ò–ó–û–í–ê–ù–ù–û–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
			    document.getElementById('user-info').classList.remove('hidden');
			    document.getElementById('auth-forms').classList.add('hidden');
			    document.getElementById('display-name').innerText = currentUserDoc.username || user.displayName || '–ò–≥—Ä–æ–∫';
			    document.getElementById('display-email').innerText = user.email || '';
			    document.getElementById('balance').innerText = String(currentUserDoc.balance || 0);
			  
			    // –û–ë–ù–û–í–õ–Ø–ï–ú HUD
			    document.getElementById('hud').classList.remove('hidden');
			    document.getElementById('hud-username').innerText = currentUserDoc.username || user.displayName || '–ò–≥—Ä–æ–∫';
			    document.getElementById('hud-email').innerText = user.email || '';
			    document.getElementById('hud-balance').innerText = String(currentUserDoc.balance || 0);
			  
			    // –ó–∞–ø—É—Å–∫–∞–µ–º listener –¥–ª—è —Å–¥–µ–ª–æ–∫
			    setupDealsListener();
			  
			    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ –ø—Ä–∞–≤–∞
			    if (isAdminUser(currentUserDoc, user)) {
				  document.getElementById('nav-admin').classList.remove('hidden');
				  document.getElementById('news-admin').classList.remove('hidden');
			    }
			  
			  } catch (error) {
			    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
			    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–π—Ç–∏.');
			    auth.signOut(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ
			  }
		    } else {
			  // –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ù–ï –ê–í–¢–û–†–ò–ó–û–í–ê–ù
			  currentUserDoc = null;
			  // UI —É–∂–µ —Å–∫—Ä—ã—Ç –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏
		    }
		  
		    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
		    await renderShop();
		  await renderMyBusinesses();
		  });

		  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
		  document.getElementById('btn-register').addEventListener('click', async () => {
		    const username = document.getElementById('reg-username').value.trim();
		    const email = document.getElementById('reg-email').value.trim();
		    const pass = document.getElementById('reg-pass').value;
		    const pass2 = document.getElementById('reg-pass2').value;
		    const codeword = document.getElementById('reg-codeword').value.trim();
		  
		    if (!username || !email || !pass || pass !== pass2 || !codeword) {
			  alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
			  return;
		    }
		  
		    try {
			  const cred = await auth.createUserWithEmailAndPassword(email, pass);
			  await cred.user.updateProfile({ displayName: username });
			  await db.collection('users').doc(cred.user.uid).set({ 
			    username, 
			    email, 
			    balance: 10000,
			    codeword,
			    totalClicks: 0,
			    clickerAmount: 0,
			    achievements: {
				  dailyQuest: false,
				  thousandClicks: false
			    },
			    questProgress: {
				  dailyClicks: 0
			    },
			    usedPromocodes: [],
			    createdAt: firebase.firestore.FieldValue.serverTimestamp()
			  });
			  alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GSK LAND!');
		    } catch (e) {
			  alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + e.message);
		    }
		  });

		  // –í—Ö–æ–¥
		  document.getElementById('btn-login').addEventListener('click', async () => {
		    const email = document.getElementById('login-email').value.trim();
		    const pass = document.getElementById('login-pass').value;
		  
		    try {
			  await auth.signInWithEmailAndPassword(email, pass);
		    } catch (e) {
			  alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + e.message);
		    }
		  });

		  // –í—ã—Ö–æ–¥
		  document.getElementById('btn-logout').addEventListener('click', () => {
		    auth.signOut();
		  });

		  // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–¥–∞–∂–∏
		  document.getElementById('sell-cancel').addEventListener('click', () => {
			document.getElementById('sell-modal').classList.add('hidden');
			currentSellBizId = null;
		  });

		  document.getElementById('sell-confirm').addEventListener('click', async () => {
			if (!currentSellBizId) return;
			
			const username = document.getElementById('sell-username').value.trim();
			const price = parseInt(document.getElementById('sell-price').value);
			
			if (!username) {
			  alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º –∏–≥—Ä–æ–∫–∞');
			  return;
			}
			
			const bizRef = db.collection('businesses').doc(currentSellBizId);
			const bizDoc = await bizRef.get();
			
			if (!bizDoc.exists) {
			  alert('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
			  return;
			}
			
			const bizData = bizDoc.data();
			const minPrice = Math.floor(bizData.price * 0.5);
			const maxPrice = Math.floor(bizData.price * 2);
			
			if (isNaN(price) || price < minPrice || price > maxPrice) {
			  alert(`–¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç ${minPrice} –¥–æ ${maxPrice} ‚ÇΩ`);
			  return;
			}
			
			try {
			  const usersSnap = await db.collection('users').where('username', '==', username).get();
			  
			  if (usersSnap.empty) {
				alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			  }
			  
			  const targetUser = usersSnap.docs[0];
			  
			  await db.collection('deals').add({
				fromUid: currentUser.uid,
				toUid: targetUser.id,
				bizId: currentSellBizId,
				price: price,
				state: 'pending',
				seen: false,
				createdAt: firebase.firestore.FieldValue.serverTimestamp()
			  });
			  
			  alert('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
			  document.getElementById('sell-modal').classList.add('hidden');
			  currentSellBizId = null;
			  document.getElementById('sell-username').value = '';
			  document.getElementById('sell-price').value = '';
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
			}
		  });

		  // –°–æ–±—Ä–∞—Ç—å –¥–æ—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö –±–∏–∑–Ω–µ—Å–æ–≤
		  document.getElementById('collect-all').addEventListener('click', async () => {
			if (!currentUser) {
			  alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
			  return;
			}
			
			try {
			  const snaps = await db.collection('businesses').where('ownerUid', '==', currentUser.uid).get();
			  let totalIncome = 0;
			  const batch = db.batch();
			  const userRef = db.collection('users').doc(currentUser.uid);
			  
			  snaps.forEach(doc => {
				const bizData = doc.data();
				const lastCollected = bizData.lastCollectedAt ? bizData.lastCollectedAt.toDate() : new Date();
				const now = new Date();
				const hoursPassed = (now - lastCollected) / (1000 * 60 * 60);
				const income = Math.floor(bizData.incomePerHour * hoursPassed);
				
				if (income > 0) {
				  totalIncome += income;
				  batch.update(doc.ref, { 
					lastCollectedAt: firebase.firestore.FieldValue.serverTimestamp() 
				  });
				}
			  });
			  
			  if (totalIncome <= 0) {
				alert('–ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞');
				return;
			  }
			  
			  batch.update(userRef, { 
				balance: firebase.firestore.FieldValue.increment(totalIncome) 
			  });
			  
			  await batch.commit();
			  alert(`–°–æ–±—Ä–∞–Ω–æ: ${totalIncome} ‚ÇΩ`);
			  await refreshUserDoc();
			  await renderMyBusinesses();
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
			}
		  });

		  // –†–µ–Ω–¥–µ—Ä —Ä–µ–π—Ç–∏–Ω–≥–∞
		  async function renderRating() {
			const el = document.getElementById('rating-list');
			el.innerHTML = '<div class="muted">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>';
			
			try {
			  const snaps = await db.collection('users').orderBy('balance', 'desc').limit(100).get();
			  const users = [];
			  
			  snaps.forEach(doc => {
				const userData = doc.data();
				if (userData.username && userData.balance !== undefined) {
				  users.push({
					username: userData.username,
					balance: userData.balance || 0,
					email: userData.email || ''
				  });
				}
			  });
			  
			  if (users.length === 0) {
				el.innerHTML = '<div class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞</div>';
				return;
			  }
			  
			  el.innerHTML = '';
			  users.forEach((user, index) => {
				const div = document.createElement('div');
				div.className = 'card';
				div.innerHTML = `
				  <strong>#${index + 1} ${user.username}</strong>
				  <div class="muted small">–ë–∞–ª–∞–Ω—Å: ${user.balance} ‚ÇΩ</div>
				  ${user.email ? `<div class="muted small">${user.email}</div>` : ''}
				`;
				el.appendChild(div);
			  });
			} catch (error) {
			  console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:', error);
			  el.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>';
			}
		  }

		  // –ö–ª–∏–∫–µ—Ä
		  async function renderClicker() {
			if (!currentUser) return;
			
			document.getElementById('clicker-amount').innerText = currentUserDoc.clickerAmount || 0;
			document.getElementById('total-clicks').innerText = currentUserDoc.totalClicks || 0;
			document.getElementById('daily-clicks').innerText = currentUserDoc.questProgress?.dailyClicks || 0;
		  }

		  document.getElementById('clicker-button').addEventListener('click', async () => {
			if (!currentUser) {
			  alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
			  return;
			}
			
			try {
			  const userRef = db.collection('users').doc(currentUser.uid);
			  await userRef.update({
				clickerAmount: firebase.firestore.FieldValue.increment(5),
				totalClicks: firebase.firestore.FieldValue.increment(1),
				'questProgress.dailyClicks': firebase.firestore.FieldValue.increment(1)
			  });
			  
			  await refreshUserDoc();
			  await renderClicker();
			  await checkAchievements();
			  await checkQuests();
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
			}
		  });

		  document.getElementById('clicker-collect').addEventListener('click', async () => {
			if (!currentUser) {
			  alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
			  return;
			}
			
			if (!currentUserDoc.clickerAmount || currentUserDoc.clickerAmount <= 0) {
			  alert('–ù–µ—á–µ–≥–æ –∑–∞–±–∏—Ä–∞—Ç—å');
			  return;
			}
			
			try {
			  const userRef = db.collection('users').doc(currentUser.uid);
			  await userRef.update({
				balance: firebase.firestore.FieldValue.increment(currentUserDoc.clickerAmount),
				clickerAmount: 0
			  });
			  
			  alert(`–ó–∞–±—Ä–∞–Ω–æ ${currentUserDoc.clickerAmount} ‚ÇΩ!`);
			  await refreshUserDoc();
			  await renderClicker();
			  await checkAchievements();
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
			}
		  });

		  // –ó–∞–¥–∞–Ω–∏—è
		  async function renderQuests() {
			const list = document.getElementById('quests-list');
			list.innerHTML = '';
			
			if (!currentUser) {
			  list.innerHTML = '<div class="muted">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–∞–¥–∞–Ω–∏—è</div>';
			  return;
			}
			
			const progress = currentUserDoc.questProgress?.dailyClicks || 0;
			const completed = currentUserDoc.achievements?.dailyQuest || false;
			
			const questCard = document.createElement('div');
			questCard.className = 'card';
			questCard.innerHTML = `
			  <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
			  <p>–°–¥–µ–ª–∞–π—Ç–µ 100 –∫–ª–∏–∫–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞"</p>
			  <div class="progress-bar">
				<div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
			  </div>
			  <div class="muted small">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}/100 –∫–ª–∏–∫–æ–≤</div>
			  ${completed ? 
				'<div class="btn" style="background:rgba(15,180,139,0.9);">–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!</div>' : 
				(progress >= 100 ? 
				  '<button class="btn" id="claim-quest">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É (10,000 ‚ÇΩ)</button>' : 
				  '<div class="muted">–ó–∞–¥–∞–Ω–∏–µ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>'
				)
			  }
			`;
			
			list.appendChild(questCard);
			
			if (progress >= 100 && !completed) {
			  document.getElementById('claim-quest').addEventListener('click', async () => {
				try {
				  const userRef = db.collection('users').doc(currentUser.uid);
				  await userRef.update({
					balance: firebase.firestore.FieldValue.increment(10000),
					'achievements.dailyQuest': true
				  });
				  
				  alert('–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞: 10,000 ‚ÇΩ!');
				  await refreshUserDoc();
				  await renderQuests();
				} catch (err) {
				  alert('–û—à–∏–±–∫–∞: ' + err.message);
				}
			  });
			}
		  }

		  // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
		  async function renderAchievements() {
			const list = document.getElementById('achievements-list');
			list.innerHTML = '';
			
			if (!currentUser) {
			  list.innerHTML = '<div class="muted">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>';
			  return;
			}
			
			const totalClicks = currentUserDoc.totalClicks || 0;
			const thousandCompleted = currentUserDoc.achievements?.thousandClicks || false;
			
			const achievements = [
			  {
				id: 'thousandClicks',
				title: '–ú–∞—Å—Ç–µ—Ä –∫–ª–∏–∫–æ–≤',
				description: '–°–¥–µ–ª–∞–π—Ç–µ 1000 –∫–ª–∏–∫–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞"',
				reward: '50,000 ‚ÇΩ',
				progress: totalClicks,
				target: 1000,
				completed: thousandCompleted
			  }
			];
			
			achievements.forEach(achievement => {
			  const achievementCard = document.createElement('div');
			  achievementCard.className = `achievement-card ${achievement.completed ? '' : 'achievement-locked'}`;
			  achievementCard.innerHTML = `
				<h3>${achievement.title}</h3>
				<p>${achievement.description}</p>
				<div class="progress-bar">
				  <div class="progress-fill" style="width: ${Math.min((achievement.progress / achievement.target) * 100, 100)}%"></div>
				</div>
				<div class="muted small">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${achievement.progress}/${achievement.target}</div>
				<div class="muted small">–ù–∞–≥—Ä–∞–¥–∞: ${achievement.reward}</div>
				${achievement.completed ? 
				  '<div class="btn" style="background:rgba(15,180,139,0.9);margin-top:8px">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!</div>' : 
				  (achievement.progress >= achievement.target ? 
					'<button class="btn" data-achievement="thousandClicks">–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>' : 
					'<div class="muted">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ</div>'
				  )
				}
			  `;
			  
			  list.appendChild(achievementCard);
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã
			document.querySelectorAll('[data-achievement]').forEach(btn => {
			  btn.addEventListener('click', async () => {
				const achievementId = btn.dataset.achievement;
				
				if (achievementId === 'thousandClicks') {
				  try {
					const userRef = db.collection('users').doc(currentUser.uid);
					await userRef.update({
					  balance: firebase.firestore.FieldValue.increment(50000),
					  'achievements.thousandClicks': true
					});
					
					alert('–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞: 50,000 ‚ÇΩ!');
					await refreshUserDoc();
					await renderAchievements();
				  } catch (err) {
					alert('–û—à–∏–±–∫–∞: ' + err.message);
				  }
				}
			  });
			});
		  }

		  // –ü—Ä–æ–º–æ–∫–æ–¥—ã
		  async function renderPromocodes() {
			const list = document.getElementById('promocodes-list');
			list.innerHTML = '';
			
			if (!currentUser) {
			  list.innerHTML = '<div class="muted">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã</div>';
			  return;
			}
			
			try {
			  const snaps = await db.collection('promocodes').get();
			  if (!snaps.empty) {
				const availablePromos = document.createElement('div');
				availablePromos.className = 'card';
				availablePromos.innerHTML = '<h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</h3>';
				
				snaps.forEach(doc => {
				  const promo = doc.data();
				  const used = currentUserDoc.usedPromocodes?.includes(doc.id) || false;
				  
				  const promoEl = document.createElement('div');
				  promoEl.className = `muted small ${used ? 'achievement-locked' : ''}`;
				  promoEl.innerHTML = `
					<strong>${promo.code}</strong> - ${promo.amount} ‚ÇΩ
					${used ? '(–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω)' : ''}
				  `;
				  availablePromos.appendChild(promoEl);
				});
				
				list.appendChild(availablePromos);
			  }
			} catch (error) {
			  console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:', error);
			}
		  }

		  document.getElementById('promocode-activate').addEventListener('click', async () => {
			if (!currentUser) {
			  alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
			  return;
			}
			
			const code = document.getElementById('promocode-input').value.trim().toUpperCase();
			
			if (!code) {
			  alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥');
			  return;
			}
			
			try {
			  const promoSnap = await db.collection('promocodes').doc(code).get();
			  
			  if (!promoSnap.exists) {
				alert('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
				return;
			  }
			  
			  const promo = promoSnap.data();
			  
			  if (currentUserDoc.usedPromocodes?.includes(code)) {
				alert('–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥');
				return;
			  }
			  
			  if (promo.uses <= 0) {
				alert('–ü—Ä–æ–º–æ–∫–æ–¥ –±–æ–ª—å—à–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω');
				return;
			  }
			  
			  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
			  const userRef = db.collection('users').doc(currentUser.uid);
			  const promoRef = db.collection('promocodes').doc(code);
			  
			  await db.runTransaction(async (tx) => {
				const userDoc = await tx.get(userRef);
				const promoDoc = await tx.get(promoRef);
				
				if (!userDoc.exists || !promoDoc.exists) throw new Error('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏');
				
				const userData = userDoc.data();
				const promoData = promoDoc.data();
				
				if (userData.usedPromocodes?.includes(code)) throw new Error('–ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω');
				if (promoData.uses <= 0) throw new Error('–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω');
				
				tx.update(userRef, {
				  balance: firebase.firestore.FieldValue.increment(promoData.amount),
				  usedPromocodes: firebase.firestore.FieldValue.arrayUnion(code)
				});
				
				tx.update(promoRef, {
				  uses: firebase.firestore.FieldValue.increment(-1),
				  usedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
				});
			  });
			  
			  alert(`–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ü–æ–ª—É—á–µ–Ω–æ ${promo.amount} ‚ÇΩ`);
			  document.getElementById('promocode-input').value = '';
			  await refreshUserDoc();
			  await renderPromocodes();
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞: ' + err.message);
			}
		  });

		  // –ê–¥–º–∏–Ω: —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
		  document.getElementById('admin-create-promo').addEventListener('click', async () => {
			if (!currentUser || !isAdminUser(currentUserDoc, currentUser)) {
			  alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');
			  return;
			}
			
			const code = document.getElementById('admin-promo-code').value.trim().toUpperCase();
			const amount = parseInt(document.getElementById('admin-promo-amount').value);
			const uses = parseInt(document.getElementById('admin-promo-uses').value);
			
			if (!code || isNaN(amount) || isNaN(uses) || amount <= 0 || uses <= 0) {
			  alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
			  return;
			}
			
			try {
			  await db.collection('promocodes').doc(code).set({
				code: code,
				amount: amount,
				uses: uses,
				createdBy: currentUser.uid,
				createdAt: firebase.firestore.FieldValue.serverTimestamp(),
				usedBy: []
			  });
			  
			  alert('–ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω!');
			  document.getElementById('admin-promo-code').value = '';
			  document.getElementById('admin-promo-amount').value = '';
			  document.getElementById('admin-promo-uses').value = '1';
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ' + err.message);
			}
		  });

		  // –ê–¥–º–∏–Ω: —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
		  document.getElementById('admin-delete-promo').addEventListener('click', async () => {
			if (!currentUser || !isAdminUser(currentUserDoc, currentUser)) {
			  alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');
			  return;
			}
			
			const code = document.getElementById('admin-promo-code').value.trim().toUpperCase();
			
			if (!code) {
			  alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
			  return;
			}
			
			if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ ${code}?`)) return;
			  
			try {
			  await db.collection('promocodes').doc(code).delete();
			  alert('–ü—Ä–æ–º–æ–∫–æ–¥ —É–¥–∞–ª–µ–Ω!');
			  document.getElementById('admin-promo-code').value = '';
			} catch (err) {
			  alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + err.message);
			}
		  });

		  // –ê–¥–º–∏–Ω: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
		  async function renderAdminUsers() {
			const list = document.getElementById('admin-users-list');
			list.innerHTML = '<div class="muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤...</div>';
			
			try {
			  const snaps = await db.collection('users').get();
			  
			  if (snaps.empty) {
				list.innerHTML = '<div class="muted">–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</div>';
				return;
			  }
			  
			  const table = document.createElement('table');
			  table.className = 'admin-table';
			  table.innerHTML = `
				<tr>
				  <th>–ù–∏–∫–Ω–µ–π–º</th>
				  <th>Email</th>
				  <th>–ö–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ</th>
				  <th>–ë–∞–ª–∞–Ω—Å</th>
				  <th>–ö–ª–∏–∫–æ–≤</th>
				</tr>
			  `;
			  
			  snaps.forEach(doc => {
				const user = doc.data();
				const row = document.createElement('tr');
				row.innerHTML = `
				  <td>${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
				  <td>${user.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
				  <td>${user.codeword || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
				  <td>${user.balance || 0} ‚ÇΩ</td>
				  <td>${user.totalClicks || 0}</td>
				`;
				table.appendChild(row);
			  });
			  
			  list.innerHTML = '';
			  list.appendChild(table);
			} catch (error) {
			  console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
			  list.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
			}
		  }

		  // –ê–¥–º–∏–Ω: –ø–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤
		  // –ê–¥–º–∏–Ω: –ø–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤
		document.getElementById('admin-search-btn').addEventListener('click', async () => {
		  if (!currentUser || !isAdminUser(currentUserDoc, currentUser)) {
			alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');
			return;
		  }
		  
		  const query = document.getElementById('admin-search-user').value.trim().toLowerCase();
		  
		  if (!query) {
			await renderAdminUsers();
			return;
		  }
		  
		  const list = document.getElementById('admin-users-list');
		  list.innerHTML = '<div class="muted">–ü–æ–∏—Å–∫...</div>';
		  
		  try {
			const snaps = await db.collection('users').get();
			const results = [];
			
			snaps.forEach(doc => {
			  const user = doc.data();
			  if (user.username && (
				user.username.toLowerCase().includes(query) ||
				(user.email && user.email.toLowerCase().includes(query)) ||
				(user.codeword && user.codeword.toLowerCase().includes(query))
			  )) {
				results.push(user);
			  }
			});
			
			if (results.length === 0) {
			  list.innerHTML = '<div class="muted">–ò–≥—Ä–æ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
			  return;
			}
			
			const table = document.createElement('table');
			table.className = 'admin-table';
			table.innerHTML = `
			  <tr>
				<th>–ù–∏–∫–Ω–µ–π–º</th>
				<th>Email</th>
				<th>–ö–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ</th>
				<th>–ë–∞–ª–∞–Ω—Å</th>
				<th>–ö–ª–∏–∫–æ–≤</th>
			  </tr>
			`;
			
			results.forEach(user => {
			  const row = document.createElement('tr');
			  row.innerHTML = `
				<td>${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
				<td>${user.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
				<td>${user.codeword || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
				<td>${user.balance || 0} ‚ÇΩ</td>
				<td>${user.totalClicks || 0}</td>
			  `;
			  table.appendChild(row);
			});
			
			list.innerHTML = '';
			list.appendChild(table);
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
			list.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</div>';
		  }
		});

		// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
		async function checkAchievements() {
		  if (!currentUser) return;
		  
		  const totalClicks = currentUserDoc.totalClicks || 0;
		  
		  if (totalClicks >= 1000 && !currentUserDoc.achievements?.thousandClicks) {
			try {
			  const userRef = db.collection('users').doc(currentUser.uid);
			  await userRef.update({
				'achievements.thousandClicks': true
			  });
			  await refreshUserDoc();
			} catch (err) {
			  console.error('–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:', err);
			}
		  }
		}

		// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π
		async function checkQuests() {
		  if (!currentUser) return;
		  
		  const dailyClicks = currentUserDoc.questProgress?.dailyClicks || 0;
		  
		  if (dailyClicks >= 100 && !currentUserDoc.achievements?.dailyQuest) {
			await refreshUserDoc();
			await renderQuests();
		  }
		}

		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π
		document.getElementById('news-add').addEventListener('click', async () => {
		  if (!currentUser) {
			alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
			return;
		  }
		  
		  if (!isAdminUser(currentUserDoc, currentUser)) {
			alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏');
			return;
		  }
		  
		  const title = document.getElementById('news-title').value.trim();
		  const content = document.getElementById('news-content').value.trim();
		  
		  if (!title || !content) {
			alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏');
			return;
		  }
		  
		  try {
			await db.collection('news').add({
			  title,
			  content,
			  author: currentUserDoc.username || currentUser.email || 'admin',
			  timestamp: firebase.firestore.FieldValue.serverTimestamp()
			});
			
			document.getElementById('news-title').value = '';
			document.getElementById('news-content').value = '';
			alert('–ù–æ–≤–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞');
		  } catch (err) {
			alert('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ' + err.message);
		  }
		});

		// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
		db.collection('news').orderBy('timestamp', 'desc').onSnapshot((snap) => {
		  const el = document.getElementById('news-list');
		  el.innerHTML = '';
		  
		  snap.forEach((doc) => {
			const news = doc.data();
			const time = news.timestamp ? news.timestamp.toDate().toLocaleString() : '';
			
			const div = document.createElement('div');
			div.className = 'news-item';
			div.innerHTML = `
			  <strong>${news.title}</strong>
			  <div class="muted small">${news.author} ‚Ä¢ ${time}</div>
			  <div style="margin-top:8px">${news.content}</div>
			`;
			
			el.appendChild(div);
		  });
		});

		// –ü–æ–∏—Å–∫ –±–∏–∑–Ω–µ—Å–∞
		document.getElementById('search-btn').addEventListener('click', async () => {
		  const query = document.getElementById('search-biz').value.trim().toLowerCase();
		  
		  if (!query) {
			await renderShop();
			return;
		  }
		  
		  const list = document.getElementById('shop-list');
		  list.innerHTML = '';
		  
		  try {
			const snaps = await db.collection('businesses').get();
			let found = false;
			
			snaps.forEach(doc => {
			  const biz = doc.data();
			  biz.id = doc.id;
			  
			  if (biz.name.toLowerCase().includes(query)) {
				found = true;
				
				const el = document.createElement('div');
				el.className = 'biz-card';
				
				const ownerText = biz.ownerUid ? 
				  '<div class="muted small">–ó–∞–Ω—è—Ç</div>' : 
				  `<button class="btn buy-btn" data-id="${biz.id}">–ö—É–ø–∏—Ç—å</button>`;
				
				el.innerHTML = `
				  <div style="display:flex;gap:12px;align-items:center">
					<img src="${biz.icon || 'https://via.placeholder.com/64/0fb48b/ffffff?text=B'}" width="64" height="64" style="border-radius:8px;object-fit:cover" />
					<div style="flex:1">
					  <strong>${biz.name}</strong>
					  <div class="muted small">–î–æ—Ö–æ–¥/—á: ${biz.incomePerHour} ‚Ä¢ –¶–µ–Ω–∞: ${biz.price} ‚ÇΩ</div>
					</div>
					<div>${ownerText}</div>
				  </div>
				`;
				
				list.appendChild(el);
			  }
			});
			
			if (!found) {
			  list.innerHTML = '<div class="muted">–ë–∏–∑–Ω–µ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
			} else {
			  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏
			  document.querySelectorAll('.buy-btn').forEach(btn => {
				btn.addEventListener('click', async (e) => {
				  const id = e.currentTarget.dataset.id;
				  
				  if (!currentUser) {
					alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
					return;
				  }
				  
				  const bizRef = db.collection('businesses').doc(id);
				  
				  try {
					await db.runTransaction(async (tx) => {
					  const bizDoc = await tx.get(bizRef);
					  
					  if (!bizDoc.exists) throw new Error('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
					  
					  const bizData = bizDoc.data();
					  
					  if (bizData.ownerUid) throw new Error('–ë–∏–∑–Ω–µ—Å —É–∂–µ –∫—É–ø–ª–µ–Ω');
					  
					  const userRef = db.collection('users').doc(currentUser.uid);
					  const userDoc = await tx.get(userRef);
					  const userData = userDoc.data();
					  
					  if (userData.balance < bizData.price) throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
					  
					  tx.update(userRef, { 
						balance: firebase.firestore.FieldValue.increment(-bizData.price) 
					  });
					  
					  tx.update(bizRef, { 
						ownerUid: currentUser.uid, 
						lastCollectedAt: firebase.firestore.FieldValue.serverTimestamp() 
					  });
					});
					
					alert('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!');
					await refreshUserDoc();
					await renderShop();
					await renderMyBusinesses();
					await renderRating();
				  } catch (err) {
					alert('–û—à–∏–±–∫–∞: ' + err.message);
				  }
				});
			  });
			}
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
			list.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</div>';
		  }
		});

		// –ê–¥–º–∏–Ω: —Å–æ–∑–¥–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞
		document.getElementById('admin-create-biz').addEventListener('click', async () => {
		  if (!currentUser || !isAdminUser(currentUserDoc, currentUser)) {
			alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');
			return;
		  }
		  
		  const name = document.getElementById('admin-biz-name').value.trim();
		  const price = parseInt(document.getElementById('admin-biz-price').value);
		  const income = parseInt(document.getElementById('admin-biz-income').value);
		  const icon = document.getElementById('admin-biz-icon').value.trim();
		  
		  if (!name || isNaN(price) || isNaN(income) || price <= 0 || income <= 0) {
			alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
			return;
		  }
		  
		  try {
			await db.collection('businesses').add({
			  name,
			  price,
			  incomePerHour: income,
			  ownerUid: null,
			  icon: icon || '',
			  lastCollectedAt: null
			});
			
			alert('–ë–∏–∑–Ω–µ—Å —Å–æ–∑–¥–∞–Ω');
			
			// –û—á–∏—â–∞–µ–º –ø–æ–ª—è
			document.getElementById('admin-biz-name').value = '';
			document.getElementById('admin-biz-price').value = '';
			document.getElementById('admin-biz-income').value = '';
			document.getElementById('admin-biz-icon').value = '';
			
			await renderShop();
		  } catch (err) {
			alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ' + err.message);
		  }
		});

		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
		async function refreshUserDoc() {
		  if (!currentUser) return;
		  
		  try {
			const userSnap = await db.collection('users').doc(currentUser.uid).get();
			
			if (userSnap.exists) {
			  currentUserDoc = userSnap.data();
			  
			  // –û–±–Ω–æ–≤–ª—è–µ–º UI
			  document.getElementById('balance').innerText = String(currentUserDoc.balance || 0);
			  document.getElementById('hud-balance').innerText = String(currentUserDoc.balance || 0);
			}
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
		  }
		}

		// –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ-–±–∏–∑–Ω–µ—Å–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
		(async function ensureDemoBusinesses() {
		  try {
			const bizSnap = await db.collection('businesses').limit(1).get();
			
			if (bizSnap.empty) {
			  // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–±–∏–∑–Ω–µ—Å—ã
			  const demoBusinesses = [
				{ name: '–ú–∞–≥–∞–∑–∏–Ω "–£ –¥–æ–º–∞"', price: 5000, incomePerHour: 50, ownerUid: null, icon: '', lastCollectedAt: null },
				{ name: '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä "–ì–∞–ª–∞–∫—Ç–∏–∫–∞"', price: 20000, incomePerHour: 300, ownerUid: null, icon: '', lastCollectedAt: null },
				{ name: '–ö–∞—Ñ–µ "–ë–æ—á–∫–∞"', price: 8000, incomePerHour: 80, ownerUid: null, icon: '', lastCollectedAt: null },
				{ name: '–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å', price: 15000, incomePerHour: 150, ownerUid: null, icon: '', lastCollectedAt: null },
				{ name: '–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã', price: 12000, incomePerHour: 120, ownerUid: null, icon: '', lastCollectedAt: null }
			  ];
			  
			  for (const biz of demoBusinesses) {
				await db.collection('businesses').add(biz);
			  }
			  
			  console.log('–î–µ–º–æ-–±–∏–∑–Ω–µ—Å—ã —Å–æ–∑–¥–∞–Ω—ã');
			}
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ-–±–∏–∑–Ω–µ—Å–æ–≤:', error);
		  }
		})();

		// –†–µ–Ω–¥–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞
		async function renderShop() {
		  const list = document.getElementById('shop-list');
		  list.innerHTML = '';
		  
		  try {
			const snaps = await db.collection('businesses').orderBy('name').get();
			
			if (snaps.empty) {
			  list.innerHTML = '<div class="muted">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–∏–∑–Ω–µ—Å–æ–≤</div>';
			  return;
			}
			
			snaps.forEach(doc => {
			  const biz = doc.data();
			  biz.id = doc.id;
			  
			  const el = document.createElement('div');
			  el.className = 'biz-card';
			  
			  const ownerText = biz.ownerUid ? 
				'<div class="muted small">–ó–∞–Ω—è—Ç</div>' : 
				`<button class="btn buy-btn" data-id="${biz.id}">–ö—É–ø–∏—Ç—å</button>`;
			  
			  el.innerHTML = `
				<div style="display:flex;gap:12px;align-items:center">
				  <img src="${biz.icon || 'https://via.placeholder.com/64/0fb48b/ffffff?text=B'}" width="64" height="64" style="border-radius:8px;object-fit:cover" />
				  <div style="flex:1">
					<strong>${biz.name}</strong>
					<div class="muted small">–î–æ—Ö–æ–¥/—á: ${biz.incomePerHour} ‚Ä¢ –¶–µ–Ω–∞: ${biz.price} ‚ÇΩ</div>
				  </div>
				  <div>${ownerText}</div>
				</div>
			  `;
			  
			  list.appendChild(el);
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫—É–ø–∫–∏
			document.querySelectorAll('.buy-btn').forEach(btn => {
			  btn.addEventListener('click', async (e) => {
				const id = e.currentTarget.dataset.id;
				
				if (!currentUser) {
				  alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
				  return;
				}
				
				const bizRef = db.collection('businesses').doc(id);
				
				try {
				  await db.runTransaction(async (tx) => {
					const bizDoc = await tx.get(bizRef);
					
					if (!bizDoc.exists) throw new Error('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
					
					const bizData = bizDoc.data();
					
					if (bizData.ownerUid) throw new Error('–ë–∏–∑–Ω–µ—Å —É–∂–µ –∫—É–ø–ª–µ–Ω');
					
					const userRef = db.collection('users').doc(currentUser.uid);
					const userDoc = await tx.get(userRef);
					const userData = userDoc.data();
					
					if (userData.balance < bizData.price) throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
					
					// –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
					tx.update(userRef, { 
					  balance: firebase.firestore.FieldValue.increment(-bizData.price) 
					});
					
					// –ù–∞–∑–Ω–∞—á–∞–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–∏–∑–Ω–µ—Å–∞
					tx.update(bizRef, { 
					  ownerUid: currentUser.uid, 
					  lastCollectedAt: firebase.firestore.FieldValue.serverTimestamp() 
					});
				  });
				  
				  alert('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!');
				  await refreshUserDoc();
				  await renderShop();
				  await renderMyBusinesses();
				  await renderRating();
				} catch (err) {
				  alert('–û—à–∏–±–∫–∞: ' + err.message);
				}
			  });
			});
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞:', error);
			list.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞</div>';
		  }
		}

		// –†–µ–Ω–¥–µ—Ä –º–æ–∏—Ö –±–∏–∑–Ω–µ—Å–æ–≤
		async function renderMyBusinesses() {
		  const list = document.getElementById('my-list');
		  list.innerHTML = '';
		  
		  if (!currentUser) {
			list.innerHTML = '<div class="muted">–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –±–∏–∑–Ω–µ—Å—ã</div>';
			return;
		  }
		  
		  try {
			const snaps = await db.collection('businesses').where('ownerUid', '==', currentUser.uid).get();
			
			if (snaps.empty) {
			  list.innerHTML = '<div class="muted">–£ –≤–∞—Å –Ω–µ—Ç –±–∏–∑–Ω–µ—Å–æ–≤</div>';
			  return;
			}
			
			snaps.forEach(doc => {
			  const biz = doc.data();
			  biz.id = doc.id;
			  
			  const lastCollected = biz.lastCollectedAt ? biz.lastCollectedAt.toDate() : new Date();
			  const now = new Date();
			  const hoursPassed = (now - lastCollected) / (1000 * 60 * 60);
			  const pendingIncome = Math.floor(biz.incomePerHour * hoursPassed);
			  
			  const el = document.createElement('div');
			  el.className = 'biz-card';
			  
			  el.innerHTML = `
				<div style="display:flex;justify-content:space-between;align-items:center">
				  <div>
					<strong>${biz.name}</strong>
					<div class="muted small">–î–æ—Ö–æ–¥/—á: ${biz.incomePerHour} ‚Ä¢ –ù–∞–∫–æ–ø–ª–µ–Ω–æ: ${pendingIncome} ‚ÇΩ</div>
				  </div>
				  <div class="flex">
					<button class="btn collect-btn" data-id="${biz.id}">–°–æ–±—Ä–∞—Ç—å</button>
					<button class="btn sell-gov" data-id="${biz.id}" style="background:rgba(200,60,60,0.9);margin-left:6px">–ü—Ä–æ–¥–∞—Ç—å –≥–æ—Å.</button>
					<button class="btn sell-player" data-id="${biz.id}" style="background:rgba(120,120,120,0.9);margin-left:6px">–ü—Ä–æ–¥–∞—Ç—å –∏–≥—Ä–æ–∫—É</button>
				  </div>
				</div>
			  `;
			  
			  list.appendChild(el);
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±–æ—Ä–∞ –¥–æ—Ö–æ–¥–∞
			document.querySelectorAll('.collect-btn').forEach(btn => {
			  btn.addEventListener('click', async (e) => {
				const id = e.target.dataset.id;
				
				if (!currentUser) {
				  alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
				  return;
				}
				
				const bizRef = db.collection('businesses').doc(id);
				
				try {
				  await db.runTransaction(async (tx) => {
					const bizDoc = await tx.get(bizRef);
					
					if (!bizDoc.exists) throw new Error('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
					
					const bizData = bizDoc.data();
					
					if (bizData.ownerUid !== currentUser.uid) throw new Error('–í—ã –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü —ç—Ç–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞');
					
					const lastCollected = bizData.lastCollectedAt ? bizData.lastCollectedAt.toDate() : new Date();
					const now = new Date();
					const hoursPassed = (now - lastCollected) / (1000 * 60 * 60);
					const income = Math.floor(bizData.incomePerHour * hoursPassed);
					
					if (income <= 0) throw new Error('–ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞');
					
					const userRef = db.collection('users').doc(currentUser.uid);
					
					tx.update(userRef, { 
					  balance: firebase.firestore.FieldValue.increment(income) 
					});
					
					tx.update(bizRef, { 
					  lastCollectedAt: firebase.firestore.FieldValue.serverTimestamp() 
					});
				  });
				  
				  alert('–î–æ—Ö–æ–¥ —Å–æ–±—Ä–∞–Ω!');
				  await refreshUserDoc();
				  await renderMyBusinesses();
				} catch (err) {
				  alert('–û—à–∏–±–∫–∞: ' + err.message);
				}
			  });
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É
			document.querySelectorAll('.sell-gov').forEach(btn => {
			  btn.addEventListener('click', async (e) => {
				const id = e.target.dataset.id;
				
				if (!confirm('–ü—Ä–æ–¥–∞—Ç—å –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É? –í—ã –ø–æ–ª—É—á–∏—Ç–µ 70% –æ—Ç —Ü–µ–Ω—ã.')) return;
				
				const bizRef = db.collection('businesses').doc(id);
				
				try {
				  await db.runTransaction(async (tx) => {
					const bizDoc = await tx.get(bizRef);
					
					if (!bizDoc.exists) throw new Error('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
					
					const bizData = bizDoc.data();
					
					if (bizData.ownerUid !== currentUser.uid) throw new Error('–í—ã –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü —ç—Ç–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞');
					
					const salePrice = Math.floor(bizData.price * 0.7);
					const userRef = db.collection('users').doc(currentUser.uid);
					
					tx.update(userRef, { 
					  balance: firebase.firestore.FieldValue.increment(salePrice) 
					});
					
					tx.update(bizRef, { 
					  ownerUid: null, 
					  lastCollectedAt: null 
					});
				  });
				  
				  alert('–ë–∏–∑–Ω–µ—Å –ø—Ä–æ–¥–∞–Ω –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤—É!');
				  await refreshUserDoc();
				  await renderShop();
				  await renderMyBusinesses();
				  await renderRating();
				} catch (err) {
				  alert('–û—à–∏–±–∫–∞: ' + err.message);
				}
			  });
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ –∏–≥—Ä–æ–∫—É
			document.querySelectorAll('.sell-player').forEach(btn => {
			  btn.addEventListener('click', async (e) => {
				const id = e.currentTarget.dataset.id;
				currentSellBizId = id;
				
				const bizRef = db.collection('businesses').doc(id);
				const bizDoc = await bizRef.get();
				
				if (!bizDoc.exists) {
				  alert('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
				  return;
				}
				
				const bizData = bizDoc.data();
				const minPrice = Math.floor(bizData.price * 0.5);
				const maxPrice = Math.floor(bizData.price * 2);
				
				document.getElementById('sell-price').placeholder = `–¶–µ–Ω–∞ –æ—Ç ${minPrice} –¥–æ ${maxPrice}`;
				document.getElementById('sell-modal').classList.remove('hidden');
			  });
			});
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–∑–Ω–µ—Å–æ–≤:', error);
			list.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–∑–Ω–µ—Å–æ–≤</div>';
		  }
		}
		
		// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞ –±–∏–∑–Ω–µ—Å–∞
		document.getElementById('search-btn').addEventListener('click', async () => {
		  const query = document.getElementById('search-biz').value.trim().toLowerCase();
		  
		  if (!query) {
			await renderShop();
			return;
		  }
		  
		  const list = document.getElementById('shop-list');
		  list.innerHTML = '';
		  
		  try {
			const snaps = await db.collection('businesses').get();
			let found = false;
			
			snaps.forEach(doc => {
			  const biz = doc.data();
			  biz.id = doc.id;
			  
			  if (biz.name.toLowerCase().includes(query)) {
				found = true;
				
				const el = document.createElement('div');
				el.className = 'biz-card';
				
				const ownerText = biz.ownerUid ? 
				  '<div class="muted small">–ó–∞–Ω—è—Ç</div>' : 
				  `<button class="btn buy-btn" data-id="${biz.id}">–ö—É–ø–∏—Ç—å</button>`;
				
				el.innerHTML = `
				  <div style="display:flex;gap:12px;align-items:center">
					<img src="${biz.icon || 'https://via.placeholder.com/64/0fb48b/ffffff?text=B'}" width="64" height="64" style="border-radius:8px;object-fit:cover" />
					<div style="flex:1">
					  <strong>${biz.name}</strong>
					  <div class="muted small">–î–æ—Ö–æ–¥/—á: ${biz.incomePerHour} ‚Ä¢ –¶–µ–Ω–∞: ${biz.price} ‚ÇΩ</div>
					</div>
					<div>${ownerText}</div>
				  </div>
				`;
				
				list.appendChild(el);
			  }
			});
			
			if (!found) {
			  list.innerHTML = '<div class="muted">–ë–∏–∑–Ω–µ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
			} else {
			  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–∫—É–ø–∫–∏
			  document.querySelectorAll('.buy-btn').forEach(btn => {
				btn.addEventListener('click', async (e) => {
				  const id = e.currentTarget.dataset.id;
				  
				  if (!currentUser) {
					alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
					return;
				  }
				  
				  const bizRef = db.collection('businesses').doc(id);
				  
				  try {
					await db.runTransaction(async (tx) => {
					  const bizDoc = await tx.get(bizRef);
					  
					  if (!bizDoc.exists) throw new Error('–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
					  
					  const bizData = bizDoc.data();
					  
					  if (bizData.ownerUid) throw new Error('–ë–∏–∑–Ω–µ—Å —É–∂–µ –∫—É–ø–ª–µ–Ω');
					  
					  const userRef = db.collection('users').doc(currentUser.uid);
					  const userDoc = await tx.get(userRef);
					  const userData = userDoc.data();
					  
					  if (userData.balance < bizData.price) throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
					  
					  tx.update(userRef, { 
						balance: firebase.firestore.FieldValue.increment(-bizData.price) 
					  });
					  
					  tx.update(bizRef, { 
						ownerUid: currentUser.uid, 
						lastCollectedAt: firebase.firestore.FieldValue.serverTimestamp() 
					  });
					});
					
					alert('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!');
					await refreshUserDoc();
					await renderShop();
					await renderMyBusinesses();
					await renderRating();
				  } catch (err) {
					alert('–û—à–∏–±–∫–∞: ' + err.message);
				  }
				});
			  });
			}
		  } catch (error) {
			console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
			list.innerHTML = '<div class="muted">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</div>';
		  }
		});

		</script>
	</body>
</html>